<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@coderuse"><meta name="twitter:title" content="Stop logging in Ubuntu"><meta name="twitter:description" content="&lt;p&gt;Now-a-days cheap VPS’s are very much available. Usually these cheap VPS’s provides very low resources. Minimum reasonable disk space, very low CPU share, 32 to 128 MB RAM. Main problem with low resources is that these fills up very quickly with logs. It would be very beneficial for these systems if the logs may be stopped or at-least minimized. And the logging also takes quite a bit CPU percentage.&lt;/p&gt;"><meta name="twitter:image" content="http://i.imgur.com/9RX3TO3.png"><title>Stop logging in Ubuntu | CodeRuse</title><link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans:300|Roboto:300|Inconsolata"><link rel="stylesheet" type="text/css" href="/css/very-simple.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="amphtml" href="./amp/index.html"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><!-- include the sidebar--><!-- include ./includes/sidebar.jade--><!-- Blog title and subtitle--><header><div class="container header"><a id="logo" href="/." class="title">CodeRuse</a><!--span.subtitle= config.subtitle--><label id="toggle-menu" for="menu" onclick><i class="fa fa-bars"></i></label></div></header><!-- use checkbox hack for toggle nav-bar on small screens--><input id="menu" type="checkbox"><!-- Navigation Links--><div id="top-nav" class="nav"><div class="container"><a href="/" class="sidebar-nav-item active">Home</a><a href="/archives" target="_blank" class="sidebar-nav-item">Archives</a><a href="http://galleries.coderuse.com" target="_blank" class="sidebar-nav-item">Galleries</a><a href="/about" target="_blank" class="sidebar-nav-item">About</a></div></div><div id="header-margin-bar"></div><!-- gallery that comes before the header--><div class="wrapper"><div class="container post-header"><h1>Stop logging in Ubuntu</h1></div></div><div class="wrapper"><div class="container meta"><div class="post-time">Jul 7, 2018</div><div class="post-categories"><a class="post-category-link" href="/categories/System/">System</a>><a class="post-category-link" href="/categories/System/Technical/">Technical</a></div><div class="post-tags"><a class="post-tag-link" href="/tags/logging/">logging</a>/<a class="post-tag-link" href="/tags/ubuntu/">ubuntu</a></div></div></div><article><div class="container post"><p>Now-a-days cheap VPS’s are very much available. Usually these cheap VPS’s provides very low resources. Minimum reasonable disk space, very low CPU share, 32 to 128 MB RAM. Main problem with low resources is that these fills up very quickly with logs. It would be very beneficial for these systems if the logs may be stopped or at-least minimized. And the logging also takes quite a bit CPU percentage.</p>
<p>By default Linux systems log very extensively for all the services running. In general we should not stop the logging service altogether. Though it’s possible by invoking the command <code>service rsyslog stop</code> [in this article we are mostly discussing about Ubuntu]. Lot of services may depend on this, as this is one of the core services of the OS.</p>
<p>But we can stop this logging altogether, keeping the <code>rsyslog</code> service running. Open the file <code>/etc/rsyslog.conf</code> and comment the line <code>$IncludeConfig /etc/rsyslog.d/*.conf</code>. Restart the service by <code>service rsyslog restart</code> or <code>systemctl restart rsyslog</code>. Check the status whether it’s running <code>service rsyslog status</code>. <code>journal</code> may show complain from <code>rsyslog</code> that, it has not found any viable configurations to log. That’s okay.</p>
<p>Another service for logging and therefore responsible for filling disk is <code>journalctl</code>. For this look for the services that are running. For <code>systemd</code> the services resides, if not otherwised customised in <code>/etc/systemd/system</code>. We can check those files if they contains any command for potential logging. In my case I run <code>Shadowsocks</code> to create secure proxy. I’ve configured this with the help of the documents from <a href="https://www.linode.com/docs/networking/vpn/create-a-socks5-proxy-server-with-shadowsocks-on-ubuntu-and-centos7/" target="_blank" rel="external">linode</a>. But in the script for running <code>Shadowsocks</code> as service, they have started and stopped the service with <code>-v</code> flag. With this flag, <code>Shadowsocks</code> logs each and every connections, that are being made through it. It kind of objects the purpose of using <code>Shadowsocks</code>. Moreover increases the log. Anyways it’s better to have it without the <code>verbose</code> flag.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ExecStart=/usr/<span class="built_in">local</span>/bin/ss-server -c /etc/shadowsocks/shadowsocks.json <span class="operator">-a</span> shadowsocks -v start</span><br><span class="line">ExecStop=/usr/<span class="built_in">local</span>/bin/ss-server -c /etc/shadowsocks/shadowsocks.json <span class="operator">-a</span> shadowsocks -v stop</span><br></pre></td></tr></table></figure>
<p>Also it would be best if nothing comes out of <code>start</code> and <code>stop</code>. So let’s dump all to <code>/dev/null</code>. So the commands would be,</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ExecStart=/usr/<span class="built_in">local</span>/bin/ss-server -c /etc/shadowsocks/shadowsocks.json <span class="operator">-a</span> shadowsocks start &gt; /dev/null</span><br><span class="line">ExecStop=/usr/<span class="built_in">local</span>/bin/ss-server -c /etc/shadowsocks/shadowsocks.json <span class="operator">-a</span> shadowsocks stop &gt; /dev/null</span><br></pre></td></tr></table></figure>
<p>To minimize the logs from <code>journalctl</code>, it’s very helpful to run a <code>cron</code> daily with the following script.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span><br><span class="line"></span></span><br><span class="line">/bin/journalctl --vacuum-time=<span class="number">1</span>d</span><br><span class="line"><span class="comment"># it's possible to ommit the following line, if one log is manageable for the system disk spce</span></span><br><span class="line">/bin/journalctl --vacuum-size=<span class="number">20</span>M</span><br></pre></td></tr></table></figure>
<p>Save the file in the <code>home</code> directory, add execution permission by <code>chmod +x clear_logs.sh</code> and set the <code>cron</code> with <code>crontab -e</code>. And add one line like <code>0 22 * * * /root/cron_Jobs/clearlogs.sh</code>. It would run the file once at 10PM.</p>
<p>Another source of logs are from web servers. For Nginx we can stop the logging by adding the following lines to the server block.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">access_<span class="built_in">log</span> off;</span><br><span class="line">error_<span class="built_in">log</span> off;</span><br></pre></td></tr></table></figure>
<p>By convention the services stores the log files inside the directory <code>/var/log</code>. Sometimes it’s helpful to check the sizes of the directories inside this. To have consolidated size of a directory use <code>du -sh &lt;directory_name&gt;</code>. To see the running log for a file, suppose <code>/var/log/syslog</code> use <code>tail -f /var/log/syslog</code>. And to see the available disk space of the system <code>df -h</code>.</p>
</div><!-- comment system--><div class="container"><div id="disqus_thread"></div><script type="text/javascript">
var disqus_shortname = 'coderuse';
var disqus_identifier = '2018/07/Stop-Logging-In-Ubuntu/';
var disqus_title = "Stop logging in Ubuntu";
var disqus_url = 'http://coderuse.com/2018/07/Stop-Logging-In-Ubuntu/';
(function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">Blog comments powered by <span class="logo-disqus">Disqus</span></a></div></article><div id="footer"><div class="container"><div class="bar"><div class="social"><a href="http://twitter.com/coderuse" target="_blank"><i class="fa fa-twitter"></i></a><a href="https://github.com/coderuse" target="_blank"><i class="fa fa-github"></i></a><a href="https://plus.google.com/+ArnabDasUIDeveloper" target="_blank"><i class="fa fa-google-plus"></i></a><a href="/atom.xml" target="_blank"><i class="fa fa-rss"></i></a></div><div class="footer">© <a href="/" rel="nofollow">CodeRuse</a> | <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0</a></div></div></div></div><script>var trackID = 'UA-70816071-1', domainID = 'coderuse.com';(function (i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r] || function(){(i[r].q=i[r].q || []).push(arguments);},i[r].l = 1 * new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.defer=1;a.src=g;m.parentNode.insertBefore(a,m)})(window, document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', trackID, domainID);ga('send', 'pageview');</script></body></html>