<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@coderuse"><meta name="twitter:title" content="Socks proxy and shadowsocks"><meta name="twitter:description" content="Socks proxy is a lightweight alternative for VPN. May be this statement is a little overdo. But sometimes we really need a socks proxy, where VPN is really not an option. Firefox (more-ly with the option for &quot;Proxy DNS&quot; in newer versions) with socks is a great combination, when anonymous browsing is required."><meta name="twitter:image" content="http://i.imgur.com/J1ZqIVa.png"><title>Socks proxy and shadowsocks | CodeRuse</title><link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans:300|Roboto:300|Inconsolata"><link rel="stylesheet" type="text/css" href="/css/very-simple.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><!-- include the sidebar--><!-- include ./includes/sidebar.jade--><!-- Blog title and subtitle--><header><div class="container header"><a id="logo" href="/." class="title">CodeRuse</a><!--span.subtitle= config.subtitle--><label id="toggle-menu" for="menu" onclick><i class="fa fa-bars"></i></label></div></header><!-- use checkbox hack for toggle nav-bar on small screens--><input id="menu" type="checkbox"><!-- Navigation Links--><div id="top-nav" class="nav"><div class="container"><a href="/" class="sidebar-nav-item active">Home</a><a href="/archives" target="_blank" class="sidebar-nav-item">Archives</a><a href="http://galleries.coderuse.com" target="_blank" class="sidebar-nav-item">Galleries</a><a href="/about" target="_blank" class="sidebar-nav-item">About</a></div></div><div id="header-margin-bar"></div><!-- gallery that comes before the header--><div class="wrapper"><div class="container post-header"><h1>Socks proxy and shadowsocks</h1></div></div><div class="wrapper"><div class="container meta"><div class="post-time">May 24, 2017</div><div class="post-categories"><a class="post-category-link" href="/categories/Anonymous/">Anonymous</a>><a class="post-category-link" href="/categories/Anonymous/Cookbook/">Cookbook</a>><a class="post-category-link" href="/categories/Anonymous/Cookbook/Technical/">Technical</a></div><div class="post-tags"><a class="post-tag-link" href="/tags/proxy/">proxy</a>/<a class="post-tag-link" href="/tags/shadowsocks/">shadowsocks</a>/<a class="post-tag-link" href="/tags/socks5/">socks5</a></div></div></div><article><div class="container post"><p>Recently I had an interesting encounter with SSH tunneling. I was searching for some option to access one VPS with Scaleway, with no public access from outside. I’ve another VPS in Scaleway with public access. Actually VPS with no public IP comes at €1.99/per month. I was thinking to host one MySQL server in that VPS. But the main problem arose, was how to access that server. After some search, I came to know, SSH tunneling is ideal for this scenario and it’s very easy to do also. In my office I use Windows workstation. There I’ve installed Git and for that I get Git Bash. And during installation I had checked the option to make all the unix tools available in path. So, I can use <code>ssh</code>, <code>ls</code>, <code>mkdir</code>, <code>awk</code>, <code>grep</code>, <code>rm</code>, <code>sed</code> all the useful commands. SSH is tunnel is also possible with <a href="https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html" target="_blank" rel="external">Putty</a>.</p>
<p>There are three types of tunnels can be made with <code>ssh</code>.</p>
<ul>
<li>local</li>
<li>remote</li>
<li>dynamic</li>
</ul>
<p>Of this three, the last one <code>dynamic</code> is of real interest for us, in regard to the socks proxy. But before that, let’s get into that topic slowly. First let’s review the other two and see their possibility and scope.</p>
<h4 id="Local-Tunnels"><a href="#Local-Tunnels" class="headerlink" title="Local Tunnels"></a>Local Tunnels</h4><p>Local tunnels make remote resources available locally. Suppose a MySQL server is running on the remote machine A behind a firewall and we have ssh access to another machine B in the same network as A. Then to access the MySQL server in A, we can invoke,</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -N: do not execute remote commands</span></span><br><span class="line"><span class="comment"># -L: bind address locally</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># local_port:A_IP or A_FQDN:A_Port_To_Bind</span></span><br><span class="line"><span class="comment"># binding to the local port 3309 with the remote port 3309</span></span><br><span class="line">ssh -N -L <span class="number">3309</span>:aa.aa.aa.aa:<span class="number">3309</span> username_on_B@bb.bb.bb.bb</span><br><span class="line"></span><br><span class="line"><span class="comment"># another usecase, though not so practical, if A is accessible</span></span><br><span class="line"><span class="comment"># and for some reason MySQL port is required as local port</span></span><br><span class="line">ssh -N -L <span class="number">3309</span>:aa.aa.aa.aa:<span class="number">3309</span> username_on_A@aa.aa.aa.aa</span><br><span class="line"></span><br><span class="line"><span class="comment"># optionally if local is bound to more than one IP address</span></span><br><span class="line"><span class="comment"># it is possible to specify local IP to bind</span></span><br><span class="line">ssh -N -L ll.ll.ll.ll:<span class="number">3309</span>:aa.aa.aa.aa:<span class="number">3309</span> username_on_A@aa.aa.aa.aa</span><br></pre></td></tr></table></figure>
<h4 id="Remote-Tunnels"><a href="#Remote-Tunnels" class="headerlink" title="Remote Tunnels"></a>Remote Tunnels</h4><p>This kind of tunnels are rarely used. It’s just opposite to the previous one. Instead of using <code>-L</code> we have to use <code>-R</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># the host part is mandatory, so we have to use either of</span></span><br><span class="line"><span class="comment"># 127.0.0.1, localhost, 0.0.0.0</span></span><br><span class="line">ssh -R <span class="number">3309</span>:<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">3309</span> username_on_B@bb.bb.bb.bb</span><br></pre></td></tr></table></figure>
<h4 id="Dynamic-Tunnels"><a href="#Dynamic-Tunnels" class="headerlink" title="Dynamic Tunnels"></a>Dynamic Tunnels</h4><p>This is of the most interest regarding the discussion about SOCKS proxy. For dynamic tunnels, we don’t have to give any specific remote port, though we have use one specific local port, that we want to pass all our traffic through.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># choice of local port is very important, but the ports</span></span><br><span class="line"><span class="comment"># 465, 587, 993 generally kept open even in very restrictive environments</span></span><br><span class="line">ssh -D <span class="number">8888</span> username_on_B@bb.bb.bb.bb</span><br></pre></td></tr></table></figure>
<p>Dynamic tunnels creates light weight SOCKS proxy, that we can use to annonymize our browsing. SOCKS proxy is app level proxy. So it works at Application Chrome and IE uses system proxy. But in Firefox, we can set proxy. Paste <code>about:preferences#advanced</code> in the address-bar of Firefox and enter. Click on the <code>Settings</code> button related to <code>Connection</code>. Choose <code>Manual Proxy Configuration</code>, put <code>127.0.0.1</code> in the host and specified port for <code>Socks Host</code>. Leave all the others blank.</p>
<p>Don’t forget to check the option <code>Proxy DNS when using SOCKS v5</code>. This option is available in newer version of Firefox. If this is checked, Firefox will try to use the DNS of the remote host, through which the proxy has been configured.</p>
<p>Also, we need to prevent the <code>WebRTC</code> leak. Type <code>about:config</code> in the address-bar and enter. Click on the button containing the text <code>I accept the risk</code> or similar like it. Search for <code>media.peerconnection.enabled</code> and double click it to make this flag false.</p>
<p>Navigate to the site <a href="https://ipleak.net/" target="_blank" rel="external">ipleak.net</a> and see if the intended IP is shown. Also don’t forget to check the DNS list. Sometimes DNS list exposes our actual location. If the DNS of your ISP is shown, try to change the nameserver inside the router or network adapter of PC. Google DNS or Free DNS responses are quite fast.</p>
<h4 id="socks5-proxy-with-ShadowSocks"><a href="#socks5-proxy-with-ShadowSocks" class="headerlink" title="socks5 proxy with ShadowSocks"></a>socks5 proxy with ShadowSocks</h4><p>Dynamic tunnels make use of SSH protocol to exchange network packets. A more sophisticated and secure option may be Shadowsocks. This uses altogether a new protocol. And it uses a different approach to encrypt and decrypt network packets. On top of Socks5, it uses a pre-specified password in server and client both to encrypt and decrypt. So, if the password is secure enough, it’s next to impossible to decrypt the packets.</p>
<p><a href="https://shadowsocks.org/en/index.html" target="_blank" rel="external">Shadowsocks</a> is very easy to configure. Unless we are deploying it as a service, it does not require much resource also. For personal use, low end servers from Linode, Vultr, Digital Ocean, Amazon Lightsail, Scaleway, Rackulous, Contabo can be used. All the them have reasonably good performance and reputation as VPS providers. Here three things should be considered during the selection of provider,</p>
<ul>
<li>location</li>
<li>price</li>
<li>bandwidth</li>
</ul>
<p>I’m using Linode with 1GB RAM, 1 shared CPU core, 1 TB bandwidth for the minimum plan of $5 per month. Performance of the VPS is pretty decent and as I’m using <code>shadowsocks-libev</code>, it’s almost nothing on the server. <code>shadowsocks-libev</code> is a Shadowsocks implementation in <em>C</em>. So, it’s fast and requires less resource. Other options can be viewed from <a href="https://shadowsocks.org/en/download/servers.html" target="_blank" rel="external">here</a>.</p>
<p>Here I’m giving a no-frill instructions to setup a Shadowsocks server on Ubuntu 16.04.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># install required softwares</span></span><br><span class="line">apt-get install --no-install-recommends build-essential autoconf libtool haveged automake \</span><br><span class="line">        libssl-dev gawk debhelper dh-systemd init-system-helpers pkg-config asciidoc \</span><br><span class="line">        xmlto apg libpcre3-dev zlib1g-dev libev-dev libudns-dev libsodium-dev libmbedtls-dev</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/shadowsocks/shadowsocks-libev.git</span><br><span class="line"><span class="built_in">cd</span> shadowsocks-libev</span><br><span class="line">git submodule update --init</span><br><span class="line"></span><br><span class="line"><span class="comment"># build and install</span></span><br><span class="line">./autogen.sh &amp;&amp; ./configure &amp;&amp; make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="comment"># this is a hack to create the autostart scripts</span></span><br><span class="line">add-apt-repository ppa:max-c-lv/shadowsocks-libev</span><br><span class="line">apt-get update</span><br><span class="line">apt install shadowsocks-libev</span><br><span class="line"></span><br><span class="line"><span class="comment"># configure the server correctly</span></span><br><span class="line">vim /etc/shadowsocks-libev/config.json</span><br><span class="line"></span><br><span class="line">apt-get remove shadowsocks-libev</span><br><span class="line"></span><br><span class="line"><span class="comment"># change the "DAEMON" localtion to '/usr/local/bin/ss-server'</span></span><br><span class="line">vim /etc/init.d/shadowsocks-libev</span><br><span class="line"></span><br><span class="line"><span class="comment"># make the server configuration file as specified below</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># reload reload daemons</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># restart the server</span></span><br><span class="line">/etc/init.d/shadowsocks-libev restart <span class="comment"># if any error occurs try with just 'start'</span></span><br></pre></td></tr></table></figure>
<p>Server configuration should be put in the file <code>/etc/shadowsocks-libev/config.json</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    "<span class="attribute">server</span>":<span class="value"><span class="string">"xx.xx.xx.xx"</span></span>,</span><br><span class="line">    "<span class="attribute">server_port</span>": <span class="value"><span class="number">1234</span></span>,</span><br><span class="line">    "<span class="attribute">local_port</span>": <span class="value"><span class="number">1234</span></span>,</span><br><span class="line">    "<span class="attribute">password</span>":<span class="value"><span class="string">"long-non-guessable-password"</span></span>,</span><br><span class="line">    "<span class="attribute">timeout</span>": <span class="value"><span class="number">600</span></span>,</span><br><span class="line">    "<span class="attribute">method</span>":<span class="value"><span class="string">"chacha20-ietf-poly1305"</span></span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure>
<p>There are a lot of options for <a href="https://shadowsocks.org/en/download/clients.html" target="_blank" rel="external">clients of Shadowsocks</a>. Install on Android or iPhone or on desktop and start to use proxy anywhere. I personally use on my Android set. It does not drain battery like the openVPN clients.</p>
<p>Though proxy is used for anonymity. It helps us to keep ourselves private. But let’s not use this to harm someone. Great power comes with great responsibility. Use them carefully.</p>
</div><!-- comment system--><div class="container"><div id="disqus_thread"></div><script type="text/javascript">
var disqus_shortname = 'coderuse';
var disqus_identifier = '2017/05/socks-proxy-and-shadowsocks/';
var disqus_title = "Socks proxy and shadowsocks";
var disqus_url = 'http://coderuse.com/2017/05/socks-proxy-and-shadowsocks/';
(function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">Blog comments powered by <span class="logo-disqus">Disqus</span></a></div></article><div id="footer"><div class="container"><div class="bar"><div class="social"><a href="http://twitter.com/coderuse" target="_blank"><i class="fa fa-twitter"></i></a><a href="https://github.com/coderuse" target="_blank"><i class="fa fa-github"></i></a><a href="https://plus.google.com/+ArnabDasUIDeveloper" target="_blank"><i class="fa fa-google-plus"></i></a><a href="/atom.xml" target="_blank"><i class="fa fa-rss"></i></a></div><div class="footer">© <a href="/" rel="nofollow">CodeRuse</a> | <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0</a></div></div></div></div><script>var trackID = 'UA-70816071-1', domainID = 'coderuse.com';(function (i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r] || function(){(i[r].q=i[r].q || []).push(arguments);},i[r].l = 1 * new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.defer=1;a.src=g;m.parentNode.insertBefore(a,m)})(window, document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', trackID, domainID);ga('send', 'pageview');</script></body></html>