<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Moving new Git branch with different history to master | CodeRuse</title><link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans:300|Roboto:300|Inconsolata"><link rel="stylesheet" type="text/css" href="/css/very-simple.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><!-- include the sidebar--><!-- include ./includes/sidebar.jade--><!-- Blog title and subtitle--><header><div class="container header"><a id="logo" href="/." class="title">CodeRuse</a><!--span.subtitle= config.subtitle--><label id="toggle-menu" for="menu" onclick><i class="fa fa-bars"></i></label></div></header><!-- use checkbox hack for toggle nav-bar on small screens--><input id="menu" type="checkbox"><!-- Navigation Links--><div id="top-nav" class="nav"><div class="container"><a href="/" class="sidebar-nav-item active">Home</a><a href="/archives" target="_blank" class="sidebar-nav-item">Archives</a><a href="http://galleries.coderuse.com" target="_blank" class="sidebar-nav-item">Galleries</a><a href="/about" target="_blank" class="sidebar-nav-item">About</a></div></div><div id="header-margin-bar"></div><!-- gallery that comes before the header--><div class="wrapper"><div class="container post-header"><h1>Moving new Git branch with different history to master</h1></div></div><div class="wrapper"><div class="container meta"><div class="post-time">Aug 22, 2016</div><div class="post-categories"><a class="post-category-link" href="/categories/Cookbook/">Cookbook</a>><a class="post-category-link" href="/categories/Cookbook/Programming/">Programming</a>><a class="post-category-link" href="/categories/Cookbook/Programming/Software-Development/">Software Development</a></div><div class="post-tags"><a class="post-tag-link" href="/tags/branch/">branch</a>/<a class="post-tag-link" href="/tags/git/">git</a></div></div></div><article><div class="container post"><p>Today I’ve learned a new thing about Git. Actually some days back, we started re-implementation of one of our old web app. Previously, the app was written with Jquery. Some days back, we felt that, it would be better, if we could use ReactJs for the app, as it only shows updates, and each of the updates has it’s own life cycle. So, thought this would be a good use case to leverage the powerful features of ReactJs.</p>
<p>Anyway, as this new development happens to be completely different than the previous one, first decided to create a new repository altogether. But, after some considerations, came to the conclusion, that it would be wrong, if we create a completely new repository for a software, that will do essentially the same things as the previous one.</p>
<p>So, created one orphan branch from master.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git checkout master</span><br><span class="line">git checkout -b --orphan new_version</span><br><span class="line">git rm &lt;all-the-unnecessary-files&gt;</span><br><span class="line"><span class="comment">## Make changes in the code base</span></span><br><span class="line">git add .</span><br><span class="line">git commit -am <span class="string">"new_version: Initialize"</span></span><br><span class="line"><span class="comment"># Generally the remote is 'origin', if not change as required</span></span><br><span class="line">git push origin new_version</span><br></pre></td></tr></table></figure>
<p>And continued development on that.</p>
<p>Until this stage, there was no problem. But, problem started, when we tried to push this branch to master. We could not merge this branch to master, as that would nullify the effort to make a new commit history for the new version.</p>
<p>Decided to delete the master branch and create new master branch from <code>new_version</code>.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Create a backup of the old version</span></span><br><span class="line">git checkout master</span><br><span class="line">git checkout -b old_version</span><br><span class="line"><span class="comment"># And push the backup to remote</span></span><br><span class="line">git push origin old_version</span><br><span class="line"><span class="comment"># '-D' is needed instead of '-d', as current branch </span></span><br><span class="line"><span class="comment"># and 'master' branch has different commit history</span></span><br><span class="line"><span class="comment">##### Following error will come</span></span><br><span class="line"><span class="comment"># error: The branch 'master' is not fully merged.</span></span><br><span class="line"><span class="comment"># If you are sure you want to delete it, run 'git branch -D master'.</span></span><br><span class="line">git branch -D master</span><br></pre></td></tr></table></figure>
<p>Now, we can’t delete the master branch from remote straight away. It would give the following error.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">To git@github.com:username/repo.git</span><br><span class="line"> ! [remote rejected] master (refusing to delete the current branch: refs/heads/master)</span><br><span class="line">error: failed to push some refs to <span class="string">'git@github.com:username/repo.git'</span></span><br></pre></td></tr></table></figure>
<p>As our repository is hosted in Github, we could change the default branch temporarily to <code>new_version</code> in the branches tab of settings page of the repository. And delete the <code>master</code> branch in <code>remote</code>.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git push origin :master</span><br><span class="line"><span class="comment"># To git@github.com:username/repo.git</span></span><br><span class="line"><span class="comment">#  - [deleted]         master</span></span><br></pre></td></tr></table></figure>
<p>Now, create the new <code>master</code> branch from <code>new_version</code>.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git checkout new_version</span><br><span class="line">git checkout -b master</span><br><span class="line"><span class="comment"># And check-in this new master branch</span></span><br><span class="line">git push origin master</span><br></pre></td></tr></table></figure>
<p>Now, change the <code>default</code> branch to <code>master</code> in Github.</p>
</div><!-- comment system--><div class="container"><div id="disqus_thread"></div><script type="text/javascript">
var disqus_shortname = 'coderuse';
var disqus_identifier = '2016/08/Moving-new-Git-branch-with-different-history-to-master/';
var disqus_title = "Moving new Git branch with different history to master";
var disqus_url = 'http://coderuse.com/2016/08/Moving-new-Git-branch-with-different-history-to-master/';
(function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">Blog comments powered by <span class="logo-disqus">Disqus</span></a></div></article><div id="footer"><div class="container"><div class="bar"><div class="social"><a href="http://twitter.com/coderuse" target="_blank"><i class="fa fa-twitter"></i></a><a href="https://github.com/coderuse" target="_blank"><i class="fa fa-github"></i></a><a href="https://plus.google.com/+ArnabDasUIDeveloper" target="_blank"><i class="fa fa-google-plus"></i></a><a href="/atom.xml" target="_blank"><i class="fa fa-rss"></i></a></div><div class="footer">© <a href="/" rel="nofollow">CodeRuse</a> | <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0</a></div></div></div></div><script>var trackID = 'UA-70816071-1', domainID = 'coderuse.com';(function (i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r] || function(){(i[r].q=i[r].q || []).push(arguments);},i[r].l = 1 * new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.defer=1;a.src=g;m.parentNode.insertBefore(a,m)})(window, document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', trackID, domainID);ga('send', 'pageview');</script></body></html>